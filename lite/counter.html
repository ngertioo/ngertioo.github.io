<html>
<head>
    <title>Manual</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="assets/js.js"></script>
</head>
<style>
        .red-text {
            color: red;
        }

        .cells {
            padding: 5px;
            font-size: 15px;
        }
        .check-hapus{
            margin-top: 8px;
            transform: scale(1.16);
        }
    </style>
<script> 
    $(function(){
    $("#includedContent").load("header.html"); 
    });
</script> 
<body>
    <div id="includedContent"></div>
    <div class="formbold-main-wrapper">
        <div class="login-form">
            <form action="" method="POST" id="dataForm">
                <div class="formbold-mb-3">
                    <div class="formbold-input-flex">
                        <div>
                            <label for="message" class="formbold-form-labell">Counter</label>
                        </div>
                    </div>
                    <textarea rows="6" name="data" id="data" class="formbold-form-inputt" required="required"></textarea><br><br>
                    <div class="formbold-input-flex">
                        <div>
                            <select id="selector-check" class="formbold-form-inputt">
                                <option value="4">4</option>
                                <option value="3">3</option>
                                <option value="2">2</option>
                            </select>
                        </div>
                        <div>
                            <label class="checkbox">
                                <input type="checkbox" class="check-hapus" value="hapus" id="hapus">
                                <span class="checkbox__icon"></span>
                                Hapus Angka Ke-5
                            </label>
                        </div>
                    </div>
                    <div class="formbold-input-flex">
                        <div>
                            <button type="button" class="button1" style="--c:#ad5c00" onclick="parseString()">Check Now</button>
                        </div>
                        <div>
                            <button type="button" class="button1" style="--c:#ad5c00" onclick="clearAll()">Clear</button>
                        </div>
                    </div>
                    
            </form>
            <br><br>
            <textarea class="formbold-form-inputt" rows="10" id="respons" hidden></textarea>
            <center>
                <div id="start-date"></div>
                <div id="counter-full"></div>
                <div id="counter-red"></div>
                <table id="resultTable"></table>
            </center>
        </div>
    </div>
<script>
function clearAll(){
    document.getElementById('data').value = "";
}

function parseString() {
    var stringInput = document.getElementById('data').value;
    var arrayAngka = stringInput.match(/\d+/g).map(function (numberString) {
        return Number(numberString).toString().padStart(numberString.length, '0');
    });
    hasil = arrayAngka.join("");
    numberArray = hasil.split('');

    
    //Menghapus digit dari posisi kelipatan 5 atau tidak
    hapusTidak = document.getElementById('hapus');
    if(hapusTidak.checked){
        for (var i = 4; i < numberArray.length; i += 5) {
            numberArray[i] = '';
        }
    }else {
        numberArray;
    }

    // Menentukan selector 
    var selector = document.getElementById('selector-check').value;
    var baris = '';
    if ( selector === "4" ){
        baris = "0";
    } else if ( selector === "3" ){
        baris = "1";
    } else if ( selector === "2" ){
        baris = "2";
    }

    // Menggabungkan array menjadi string dengan delimiter setiap 4 digit
    var resultString = numberArray.join('');
    var resultArray = resultString.match(/.{1,4}/g);
    var per4 = resultArray.join('*');

    document.getElementById("respons").value = per4 ;

    // Menampilkan hasil dalam tabel
    var resultTable = document.getElementById("resultTable");
    resultTable.innerHTML = ""; // Membersihkan tabel sebelum menambahkan hasil baru
    countFull = resultArray.length;
    // Memeriksa dan menampilkan hasil dalam tabel dengan penanda warna merah jika ada digit yang sama dengan deret sebelumnya
    var prevResult = "";
    var countRed = 0;
    for (var j = 0; j < resultArray.length; j++) {
        if (j % 7 === 0) {
            var row = resultTable.insertRow();
        }

        var currentResult = resultArray[j];
        var cell = row.insertCell(j % 7);
        cell.innerHTML = currentResult;
        cell.classList.add("cells");

        // Pengecekan dan penandaan warna merah per digit
        if (j > 0) {
            for (var k = baris; k < currentResult.length; k++) {
                if (currentResult.charAt(k) === prevResult.charAt(k)) {
                    cell.classList.add("red-text");
                    countRed++;
                    break;
                }
            }
        }

        prevResult = currentResult;
    }
    document.getElementById('start-date').innerHTML = "Start Mulai Tanggal : " + hitungDanTampilkanTanggal(countFull);
    document.getElementById('counter-full').innerHTML = "Jumlah Semua : " + countFull;
    document.getElementById('counter-red').innerHTML = "Jumlah zonk : " + countRed;
}

function hitungDanTampilkanTanggal(jumlah) {
var tambahanHariInput = jumlah;
var tambahanHari = parseInt(tambahanHariInput);

if (!isNaN(tambahanHari)) {
    // Membuat objek Date yang mewakili waktu saat ini
    var tanggalSaatIni = new Date();

    // Menambahkan jumlah hari yang diinput
    tanggalSaatIni.setDate(tanggalSaatIni.getDate() - tambahanHari);

    // Mendapatkan komponen tanggal dari objek Date
    var tanggal = tanggalSaatIni.getDate();
    var bulan = tanggalSaatIni.getMonth() + 1; // Perlu ditambah 1 karena indeks bulan dimulai dari 0
    var tahun = tanggalSaatIni.getFullYear();

    var tanggalmulai = tanggal+'-'+bulan+'-'+tahun;
    return tanggalmulai;
    } 

}
</script>
